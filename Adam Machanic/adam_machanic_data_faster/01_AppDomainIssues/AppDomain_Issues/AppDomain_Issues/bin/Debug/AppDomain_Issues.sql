/*
Deployment script for HotelSample
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, QUOTED_IDENTIFIER ON;

SET CONCAT_NULL_YIELDS_NULL, NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "HotelSample"
:setvar DefaultDataPath "D:\SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "D:\SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
USE [master]
GO
USE [$(DatabaseName)]
GO
IF EXISTS (SELECT * FROM tempdb..sysobjects WHERE id=OBJECT_ID('tempdb..#tmpErrors')) DROP TABLE #tmpErrors
GO
CREATE TABLE #tmpErrors (Error int)
GO
SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
GO
BEGIN TRANSACTION
GO
PRINT N'Dropping [dbo].[SpinFor20Seconds_NoYield]...';


GO
DROP PROCEDURE [dbo].[SpinFor20Seconds_NoYield];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[SpinFor20Seconds_Preemptive]...';


GO
DROP PROCEDURE [dbo].[SpinFor20Seconds_Preemptive];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[SpinFor20Seconds_Yield]...';


GO
DROP PROCEDURE [dbo].[SpinFor20Seconds_Yield];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [AppDomain_Issues]...';


GO
DROP ASSEMBLY [AppDomain_Issues];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [AppDomain_Issues]...';


GO
CREATE ASSEMBLY [AppDomain_Issues]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300CA33AA510000000000000000E00002210B0108000012000000060000000000005E3100000020000000400000000040000020000000020000040000000000000004000000000000000080000000020000000000000300408500001000001000000000100000100000000000001000000000000000000000000C3100004F000000004000007803000000000000000000000000000000000000006000000C000000543000001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000064110000002000000012000000020000000000000000000000000000200000602E7273726300000078030000004000000004000000140000000000000000000000000000400000402E72656C6F6300000C000000006000000002000000180000000000000000000000000000400000420000000000000000000000000000000040310000000000004800000002000500082300004C0D00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133002001B0000000100001100166A0A2B07000006176A580A062000EA56FA6EFE040B072DEC2A0013300200490000000200001100281000000A0A160B2B31000716FE0216FE010D092D0716281100000A00166A0C2B07000008176A580C08208845C8006AFE040D092DEC000717580B072040010000FE040D092DC32A00000013300200270000000100001100281200000A00166A0A2B07000006176A580A062000EA56FA6EFE040B072DEC281300000A002A001B300200290000000300001100731400000A0A06250B281500000A00002030750000281100000A0000DE0807281600000A00DC002A00000001100000020010000F1F0008000000001E02281400000A2A133002005600000004000011282000000A6F2100000A027B03000004330F027B020000041FFEFE0116FE012B01170C082D0B02167D02000004020A2B071673100000060A06027B050000047D0400000406027B070000047D06000004060B2B00072A0000133001000B000000050000110228090000060A2B00062A00133003008C00000006000011027B020000040B07450200000004000000020000002B042B3C2B022B6902157D020000040002027C04000004282200000A7D080000042B330002027B080000048C1D0000017D0100000402177D02000004170A2B3502157D020000040002257B0800000417587D08000004027B08000004027C06000004282200000AFE0216FE010C082DB300160A2B00062A133001000B00000007000011027B010000040A2B00062A1A732300000A7A0A002A000000133001000B00000007000011027B010000040A2B00062A7A02281400000A02037D0200000402282000000A6F2100000A7D030000042A0000133002001C000000080000111FFE73100000060A06027D0500000406037D07000004060B2B00072A4E000302A51D000001732400000A81030000012A1E02281400000A2A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000A4040000237E000010050000B406000023537472696E677300000000C40B00000800000023555300CC0B0000100000002347554944000000DC0B00007001000023426C6F6200000000000000020000015717A20B0902000000FA253300160000010000001F0000000400000008000000100000000500000005000000250000001700000008000000010000000200000002000000070000000200000001000000020000000100000000000A00010000000000060055004E000600D600C3000A000301EE0006005F01400106007E016C01060095016C010600B2016C010600D1016C010600EA016C01060003026C0106001E026C01060039026C01060052024001060066026C01060092027F023F00A60200000600D502B5020600F502B5020A003F032403060055034E000600770366030600AA0366030A00BD0324030600FE03E30306000C04E30306001A04C300060026044E00060035067F0206007D064E00060083064E0006009906B5020000000001000000000001000100010010001F000000050001000100010010003000000005000100060003011000D20300000500010009000100BA04CA0001006305D60001006E05D60006002701D9000600AE05D90006003001D9000600BC05D9000600C805D60050200000000096005C000A000100782000000000960075000A000100D0200000000096008C000A0001000421000000009600A8000A0001004C21000000008618BD000E000100C4220000000096000C0112000100EC2200000000960017011B0003000023000000008618BD000E000500542100000000E1013204B0000500B82100000000E1018404C1000500D02100000000E101B104C6000500682200000000E109C704CD0005007F2200000000E10115050E000500862200000000E10140050E0005008C2200000000E1098305CD000500A322000000008618BD0033000500000001002701000002003001000001003701020002003901000001006305040006000400090004000A000400690004006D002100BD000E002900BD0023003100BD0023003900BD0023004100BD0023004900BD0023005100BD0023005900BD0023006100BD0023006900BD0028007100BD0023007900BD002D008900BD0033009100BD000E009900BD000E00A1005E034200A9007E034700A90084030A00A90098030A000900BD000E00B100B2035400B100B8035400B900BD000E000C007604B80011007604C100D100B104C60014000905D100D1003A050E00D9005B050E00D1000905CD00E100BD000E00A9004D06E100A9005F06E60019007306E600F100BD000E001900BD003300F900BD000E0020007B0038002E00730051012E002B0021012E006B0048012E0033000B012E0063003F012E001B0021012E00230021012E0013000B012E003B0027012E00430021012E005300210140007B00380060007B00380080007B00380083002B013800C000BB005E002001FB0038004001FB0038008001FB003800A001FB003800E001FB0038000002FB0038003D004C005900EA00F500FA0000010401040001000000D005DD0000000E06DD0002000C00030002000F00050004001200310004001400330004001600350004001800370004001A00390004001C003B0004001E003D00A400AA0004800000010000002413FD590000000000001303000002000000000000000000000001004500000000000200000000000000000000000100E20000000000040003000000003C4D6F64756C653E00417070446F6D61696E5F4973737565732E646C6C0053746F72656450726F636564757265730055736572446566696E656446756E6374696F6E73006D73636F726C69620053797374656D004F626A656374005370696E466F7232305365636F6E64735F4E6F5969656C64005370696E466F7232305365636F6E64735F5969656C64005370696E466F7232305365636F6E64735F507265656D707469766500456E7465724D6F6E69746F72416E64536C656570002E63746F720053797374656D2E436F6C6C656374696F6E730049456E756D657261626C650053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C496E743332004765744E756D62657273004765744E756D626572735F46696C6C005374617274696E6700456E64696E67006F004E756D6265720053797374656D2E52756E74696D652E496E7465726F705365727669636573004F75744174747269627574650053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500417070446F6D61696E5F497373756573004D6963726F736F66742E53716C5365727665722E5365727665720053716C50726F636564757265417474726962757465004461746554696D65006765745F4E6F770053797374656D2E546872656164696E670054687265616400536C65657000426567696E546872656164416666696E69747900456E64546872656164416666696E697479004D6F6E69746F7200456E74657200457869740053716C46756E6374696F6E417474726962757465003C4765744E756D626572733E645F5F300053797374656D2E436F6C6C656374696F6E732E47656E657269630049456E756D657261626C6560310049456E756D657261746F7260310049456E756D657261746F720049446973706F7361626C650053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261626C653C53797374656D2E4F626A6563743E2E476574456E756D657261746F7200476574456E756D657261746F720053797374656D2E436F6C6C656374696F6E732E49456E756D657261626C652E476574456E756D657261746F72004D6F76654E657874003C3E325F5F63757272656E740053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E4F626A6563743E2E6765745F43757272656E74006765745F43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E52657365740052657365740053797374656D2E49446973706F7361626C652E446973706F736500446973706F7365003C3E315F5F7374617465003C3E6C5F5F696E697469616C54687265616449640053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E6765745F43757272656E74003C3E335F5F5374617274696E67003C3E335F5F456E64696E67003C693E355F5F310053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E4F626A6563743E2E43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E43757272656E7400446562756767657248696464656E417474726962757465006765745F43757272656E74546872656164006765745F4D616E616765645468726561644964006765745F56616C756500496E743332004E6F74537570706F72746564457863657074696F6E00436F6D70696C657247656E657261746564417474726962757465000003200000000000863061AEC5E6714687C073743EE0CB480008B77A5C561934E08903000001032000010800021209110D110D070002011C10110D042001010E0420010102052001011141042001010804010000000407020A02040000115104000101080707041151080A02040001011C0407021C1C4501000200540E1146696C6C526F774D6574686F644E616D650F4765744E756D626572735F46696C6C540E0F5461626C65446566696E6974696F6E0A4E756D62657220494E5405151261011C05151265011C072000151265011C08200015126501130004200012690320000202061C0320001C04200013000206080306110D0328001C0400001255032000080A07031210151265011C0204070112690507030208020307011C0607021210120915010010417070446F6D61696E5F497373756573000005010000000017010012436F7079726967687420C2A920203230313300000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100000000CA33AA5100000000020000009900000070300000701200005253445315F5AF73FA834245AF06D2D525A253FD20000000433A5C55736572735C4164616D5C4465736B746F705C546563684564323031335F446174615F4661737465725C30315F417070446F6D61696E4973737565735C417070446F6D61696E5F4973737565735C417070446F6D61696E5F4973737565735C6F626A5C44656275675C417070446F6D61696E5F4973737565732E706462000000003431000000000000000000004E31000000200000000000000000000000000000000000000000000040310000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000200300000000000000000000200334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100FD59241300000100FD5924133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00480020000010053007400720069006E006700460069006C00650049006E0066006F0000005C02000001003000300030003000300034006200300000004C0011000100460069006C0065004400650073006300720069007000740069006F006E000000000041007000700044006F006D00610069006E005F004900730073007500650073000000000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003900300030002E0032003300300033003700000000004C001500010049006E007400650072006E0061006C004E0061006D006500000041007000700044006F006D00610069006E005F004900730073007500650073002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100330000005400150001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000041007000700044006F006D00610069006E005F004900730073007500650073002E0064006C006C0000000000440011000100500072006F0064007500630074004E0061006D0065000000000041007000700044006F006D00610069006E005F004900730073007500650073000000000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003900300030002E00320033003000330037000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003900300030002E00320033003000330037000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000603100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    WITH PERMISSION_SET = UNSAFE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[SpinFor20Seconds_NoYield]...';


GO
CREATE PROCEDURE [dbo].[SpinFor20Seconds_NoYield]

AS EXTERNAL NAME [AppDomain_Issues].[StoredProcedures].[SpinFor20Seconds_NoYield]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[SpinFor20Seconds_Preemptive]...';


GO
CREATE PROCEDURE [dbo].[SpinFor20Seconds_Preemptive]

AS EXTERNAL NAME [AppDomain_Issues].[StoredProcedures].[SpinFor20Seconds_Preemptive]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[SpinFor20Seconds_Yield]...';


GO
CREATE PROCEDURE [dbo].[SpinFor20Seconds_Yield]

AS EXTERNAL NAME [AppDomain_Issues].[StoredProcedures].[SpinFor20Seconds_Yield]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[EnterMonitorAndSleep]...';


GO
CREATE PROCEDURE [dbo].[EnterMonitorAndSleep]

AS EXTERNAL NAME [AppDomain_Issues].[StoredProcedures].[EnterMonitorAndSleep]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[GetNumbers]...';


GO
CREATE FUNCTION [dbo].[GetNumbers]
(@Starting INT, @Ending INT)
RETURNS 
     TABLE (
        [Number] INT NULL)
AS
 EXTERNAL NAME [AppDomain_Issues].[UserDefinedFunctions].[GetNumbers]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
IF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION
GO
IF @@TRANCOUNT>0 BEGIN
PRINT N'The transacted portion of the database update succeeded.'
COMMIT TRANSACTION
END
ELSE PRINT N'The transacted portion of the database update failed.'
GO
DROP TABLE #tmpErrors
GO
