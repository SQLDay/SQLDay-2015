/*
Deployment script for AdventureWorks
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, QUOTED_IDENTIFIER ON;

SET CONCAT_NULL_YIELDS_NULL, NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "AdventureWorks"
:setvar DefaultDataPath "E:\ss2008\MSSQL10_50.SS2008\MSSQL\DATA\"
:setvar DefaultLogPath "E:\ss2008\MSSQL10_50.SS2008\MSSQL\DATA\"

GO
:on error exit
GO
USE [master]
GO
USE [$(DatabaseName)]
GO
IF EXISTS (SELECT * FROM tempdb..sysobjects WHERE id=OBJECT_ID('tempdb..#tmpErrors')) DROP TABLE #tmpErrors
GO
CREATE TABLE #tmpErrors (Error int)
GO
SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
GO
BEGIN TRANSACTION
GO
PRINT N'Creating [intervals]...';


GO
CREATE ASSEMBLY [intervals]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103007421A5510000000000000000E00002210B010B000014000000060000000000005E3300000020000000400000000040000020000000020000040000000000000004000000000000000080000000020000000000000300408500001000001000000000100000100000000000001000000000000000000000000833000053000000004000008003000000000000000000000000000000000000006000000C000000703200001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000064130000002000000014000000020000000000000000000000000000200000602E7273726300000080030000004000000004000000160000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001A0000000000000000000000000000400000420000000000000000000000000000000040330000000000004800000002000500B4240000BC0D000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B300500270300000100001100731000000A0A06176F1100000A00066F1200000A731300000A0B00076F1400000A0C0872010000706F1500000A00076F1600000A00081F206F1700000A0D161304731800000A13051206206C0700001717281900000A001613071613081A8D1D000001130C110C1672500200701E731A00000AA2110C1772600200701F1F731A00000AA2110C18727C0200701F1F731A00000AA2110C1972940200701E731A00000AA2110C731B00000A1309110919166F1C00000A00281D00000A11096F1E00000A0038C10100000009166F1F00000A1104FE01130D110D3A97000000002B4500110611056F2000000A11086F2100000A1107120928030000060011056F2000000A11086F2100000A1306110711056F2200000A11086F2300000A59130711081758130800110716FE02130D110D2DB0110928020000060011056F2400000A001206206C0700001717281900000A0016130716130809166F1F00000A130411091611046F1C00000A00110919166F1C00000A000009176F2500000A130A09186F2500000A130B110A1106282600000A16FE01130D110D3AB0000000002B4500110611056F2000000A11086F2100000A1107120928030000060011056F2000000A11086F2100000A1306110711056F2200000A11086F2300000A59130711081758130800110716311711056F2000000A11086F2100000A110A282700000A2B0116130D110D2D98110A1106282600000A16FE01130D110D2D3200110716FE0216FE01130D110D2D1E001106120A23000000000000F0BF282800000A1107120928030000060000110A130600001105110B6F2900000A130D110D2D0D1105110B176F2A00000A002B1B110525130E110B25130F110E110F6F2B00000A17586F2C00000A0011071758130700096F2D00000A130D110D3A30FEFFFF2B5700110611056F2000000A11086F2100000A1107120928030000060011056F2000000A11086F2100000A130F120F23000000000000F03F282800000A1306110711056F2200000A11086F2300000A59130711081758130800110716FE02130D110D2D9E1109280200000600281D00000A6F2E00000A0000DE120714FE01130D110D2D07076F2F00000A00DC002A00411C0000020000001B000000F8020000130300001200000000000000133002001C000000020000110002196F3000000A16FE010A062D0C281D00000A026F3100000A002A13300400D600000003000011000550196F3000000A16FE010A063A9300000000020550186F3200000A0B120123000000000000F03F282800000A283300000A2C10040550196F3000000AFE0116FE012B01170A062D1D000550180F0123000000000000F0BF282800000A6F3400000A00002B3C00281D00000A05506F3100000A00055017026F3400000A000550180F0123000000000000F0BF282800000A6F3400000A00055019046F1C00000A0000002B2F00055017026F3400000A000550180F0123000000000000F0BF282800000A6F3400000A00055019046F1C00000A00002A1E02283500000A2A000042534A4201000100000000000C00000076342E302E33303331390000000005006C00000080030000237E0000EC0300003C05000023537472696E67730000000028090000B002000023555300D80B0000100000002347554944000000E80B0000D401000023426C6F620000000000000002000001471502080900000000FA2533001600000100000023000000020000000400000005000000350000000D0000000300000003000000010000000300000000000A000100000000000600390032000A008200670006009B0032000600DF00C50006000A01F80006002101F80006003E01F80006005D01F80006007601F80006008F01F8000600AA01F8000600C501F8000600FD01DE0106001102F80006003D022A023F00510200000600800260020600A00260020A00C80267000A00F402DE020A00380325030A006703DE020A007503DE020A008E0325030A00A80325030A00BA03DE020A00C8035B000E000104E6030A000E0467000A001A045B000A002D0467000A00380467000A005A04250306007004E6030600FE04320000000000010000000000010001000100100018000000050001000100502000000000960040000A000100A02300000000910090000E000100C823000000009100900014000200AA24000000008618A4002000060000000100AA0000000100B50000000200BB0000000300BF0000000400AA002100A40024002900A40024003100A40024003900A40024004100A40024004900A40024005100A40024005900A40024006100A40024006900A40029007100A40024007900A4002E008900A40034009100A40020009900A4002000A100A4002000A1000F032900A90052033E00B100A4002400B10080034200C10098032400C900B5032000B900D80347000C00A40020001900A4005600E900A4005D001100A4006400110024046B00F90040047100010149047700090167047D000C00780482001400810494000C008A049A001C00810494000C009504200009019B04AB001900A704B1001900B604B1001900C904B9000C00D104BF000C00DD04C5000C008104CD000C00E104C5000901EA04D4000101EF04200019010A052000110067047D0001011205770011009B04AB0019002105B10011002D0506010900A400200020007B0039002E0033005B012E0013005B012E001B006A012E0023006A012E002B0070012E000B0013012E003B007F012E0043006A012E0053006A012E006300A0012E006B00A9012E007300B201D80002010D014E008C00A40004800000010000002013D273000000000000BE020000040000000000000000000000010029000000000004000000000000000000000001005B0000000000040000000000000000000000010032000000000000000000003C4D6F64756C653E00696E74657276616C732E646C6C0053746F72656450726F63656475726573006D73636F726C69620053797374656D004F626A65637400476574486F74656C53746179496E74657276616C436F756E74730053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E5365727665720053716C446174615265636F72640073656E64526573756C74004461746554696D65002E63746F72006E657874526573756C7400737461727400656E6400636F756E740053797374656D2E52756E74696D652E56657273696F6E696E67005461726765744672616D65776F726B4174747269627574650053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500696E74657276616C730053716C50726F6365647572654174747269627574650053797374656D2E446174612E53716C436C69656E740053716C436F6E6E656374696F6E537472696E674275696C646572007365745F436F6E74657874436F6E6E656374696F6E0053797374656D2E446174612E436F6D6D6F6E004462436F6E6E656374696F6E537472696E674275696C646572006765745F436F6E6E656374696F6E537472696E670053716C436F6E6E656374696F6E0053716C436F6D6D616E6400437265617465436F6D6D616E64004462436F6D6D616E64007365745F436F6D6D616E6454657874004462436F6E6E656374696F6E004F70656E0053716C4461746152656164657200436F6D6D616E644265686176696F7200457865637574655265616465720053797374656D2E436F6C6C656374696F6E732E47656E6572696300536F727465644C69737460320053716C4D657461446174610053716C44625479706500536574496E7433320053716C436F6E746578740053716C50697065006765745F506970650053656E64526573756C747353746172740044624461746152656164657200476574496E74333200494C6973746031006765745F4B657973006765745F4974656D006765745F56616C75657300436C656172004765744461746554696D65006F705F477265617465725468616E006F705F4C6573735468616E4F72457175616C004164644461797300436F6E7461696E734B657900416464007365745F4974656D00526561640053656E64526573756C7473456E640049446973706F7361626C6500446973706F73650053656E64526573756C7473526F77006F705F457175616C697479005365744461746554696D650000000000824D530045004C004500430054000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200048006F00740065006C00490064002C000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200043006800650063006B0049006E0044006100740065002C000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200043006800650063006B004F007500740044006100740065000D000A002000200020002000200020002000200020002000200020002000200020002000460052004F004D002000640062006F002E0048006F00740065006C00530074006100790073000D000A0020002000200020002000200020002000200020002000200020002000200020004F0052004400450052002000420059000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200048006F00740065006C00490064002C000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200043006800650063006B0049006E0044006100740065002C000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200043006800650063006B004F007500740044006100740065002C000D000A0020002000200020002000200020002000200020002000200020002000200020002000200020002000530074006100790049006400000F48006F00740065006C0049006400001B69006E00740065007200760061006C0053007400610072007400001769006E00740065007200760061006C0045006E006400001B6E0075006D006200650072004F00660052006F006F006D00730000E0F8617E0F80104A89BA4AA5227AEB150008B77A5C561934E089030000010500010112090B000401110D110D0810120903200001042001010E0420010102052001011141042001010804010000000320000E042000125D0620011269116D0715127102110D0806200301080808062002010E1179062001011D1275052002010808050000128081052001011209042001080809200015128089011300071512808901110D0520011300080920001512808901130106151280890108052001110D0807000202110D110D052001110D0D0520010213000720020113001301062001130113000320000229071012511259125D12690815127102110D08110D08081209110D110D1D12750215127102110D08110D030701020620020108110D05070202110D4701001A2E4E45544672616D65776F726B2C56657273696F6E3D76342E300100540E144672616D65776F726B446973706C61794E616D65102E4E4554204672616D65776F726B20340E010009696E74657276616C7300000501000000000E0100094D6963726F736F667400002001001B436F7079726967687420C2A9204D6963726F736F6674203230313300000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301000000000000007421A55100000000020000007C0000008C3200008C14000052534453E9917F3C8BB7A6458D0A6851B22AD96B12000000633A5C75736572735C616D616368616E695C646F63756D656E74735C76697375616C2073747564696F20323031305C50726F6A656374735C696E74657276616C735C696E74657276616C735C6F626A5C44656275675C696E74657276616C732E706462003033000000000000000000004E3300000020000000000000000000000000000000000000000000004033000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000280300000000000000000000280334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100D273201300000100D27320133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00488020000010053007400720069006E006700460069006C00650049006E0066006F00000064020000010030003000300030003000340062003000000034000A00010043006F006D00700061006E0079004E0061006D006500000000004D006900630072006F0073006F006600740000003C000A000100460069006C0065004400650073006300720069007000740069006F006E000000000069006E00740065007200760061006C007300000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003800390036002E0032003900360035003000000000003C000E00010049006E007400650072006E0061006C004E0061006D006500000069006E00740065007200760061006C0073002E0064006C006C0000005C001B0001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004D006900630072006F0073006F0066007400200032003000310033000000000044000E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000069006E00740065007200760061006C0073002E0064006C006C00000034000A000100500072006F0064007500630074004E0061006D0065000000000069006E00740065007200760061006C007300000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003800390036002E00320039003600350030000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003800390036002E0032003900360035003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000603300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    WITH PERMISSION_SET = SAFE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[GetHotelStayIntervalCounts]...';


GO
CREATE PROCEDURE [dbo].[GetHotelStayIntervalCounts]

AS EXTERNAL NAME [intervals].[StoredProcedures].[GetHotelStayIntervalCounts]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
IF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION
GO
IF @@TRANCOUNT>0 BEGIN
PRINT N'The transacted portion of the database update succeeded.'
COMMIT TRANSACTION
END
ELSE PRINT N'The transacted portion of the database update failed.'
GO
DROP TABLE #tmpErrors
GO
