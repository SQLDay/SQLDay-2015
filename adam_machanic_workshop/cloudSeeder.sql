IF EXISTS (SELECT * FROM sys.objects WHERE name = 'startSeeding' AND OBJECT_SCHEMA_NAME(object_id) = 'dbo') 
    DROP PROCEDURE [dbo].[startSeeding]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE name = 'stopSeeding' AND OBJECT_SCHEMA_NAME(object_id) = 'dbo') 
    DROP PROCEDURE [dbo].[stopSeeding]
GO

IF EXISTS (SELECT * FROM sys.assemblies WHERE NAME = 'cloudSeeder') 
	DROP ASSEMBLY [cloudSeeder]
GO

CREATE ASSEMBLY [cloudSeeder]
AUTHORIZATION [dbo]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103001ED192510000000000000000E00002210B010800000E000000060000000000000E2C0000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000B42B000057000000004000005803000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000140C000000200000000E000000020000000000000000000000000000200000602E7273726300000058030000004000000004000000100000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001400000000000000000000000000004000004200000000000000000000000000000000F02B0000000000004800000002000500342300008008000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001E02280E00000A2A1B30020028010000010000117F03000004280F00000A26027B060000042C05281000000A160A281100000A0B0617580A06174093000000FE137E010000042C6B38D30000007F02000004281200000A0C08166A32247F04000004280F00000A690D7E05000004096F1300000A6F1400000A16281500000A2B327E05000004251304281600000A7F02000004281700000A166A2F0D7F02000004166A281800000A26DE891104281900000ADCFE137E010000043A75FFFFFF7F02000004281700000A166A33803862FFFFFF0620102700004057FFFFFF160A027B07000004163E49FFFFFF281100000A1305120507281A00000A13061206281B00000A027B070000046C4325FFFFFF16281500000A281100000A0B3814FFFFFFDE197F03000004281200000A26027B060000042C05281C00000ADC2A41340000020000007A0000001D00000097000000080000000000000002000000000000000E0100000E01000019000000000000001B300300C300000002000011140D730500000613041104037D060000041104047D07000004FE137E010000042C012A281000000A160A2B27092D0E1104FE0606000006731D00000A0D09731E00000A0B7E05000004076F1F00000A0617580A060232D5FE137E010000042D467E05000004251305281600000A7F02000004026A282000000A26DE2A1105281900000ADC7F04000004280F00000A690C7E05000004086F1300000A6F1400000A16281500000AFE137E010000042D0E7F02000004281200000A166A2FC7281C00000A2A000110000002006D000F7C00080000000003300200510000000000000017FE1380010000047F02000004166A281800000A267F04000004156A281800000A2620A0860100732100000A80050000042B071F0A281500000A7F03000004281700000A166A30EB16FE1380010000042AB616FE138001000004166A8002000004166A8003000004156A800400000420A0860100732100000A80050000042A1E02280E00000A2A0042534A4201000100000000000C00000076322E302E35303732370000000005006C00000000030000237E00006C030000F403000023537472696E67730000000060070000080000002355530068070000100000002347554944000000780700000801000023426C6F620000000000000002000001571502080902000000FA253300160000010000001700000003000000070000000600000003000000220000000D000000020000000100000001000000020000000100000000000A0001000000000006003B0034000600620042000600C300A8000600DB00CA0006003D012B01060054012B01060071012B01060090012B010600A9012B010600C2012B010600DD012B010600F8012B01060030021102060044022B0106005D02420006007D0242000A00CE02B30206000A03CA0006003403340006006403CA000600850334000600BF03CA000600D60342000000000001000000000001000100010010001A00000005000100010003011000E402000005000600050011006D000A00110076000F00110087000F00110096000F001100E2001200060017013D00060023014000C021000000009600ED001A000100A022000000009600FA00210004002B23000000008618060125000400FD22000000009118CF032100040050200000000086180601250004005820000000008600F70225000400000001000C01000002001701000003002301290006012900310006012900390006012900410006012900490006012900510006012900590006012900610006012900690006012E0071000601290079000601330081000601250089000601250009000601250091001603430021002003210099003D0349009100450343000C004F03550021005803250021005E035B00A1006C036000910072034300910077036500A1008003600099008E036C00A900970373002100AD032100B10006018900210006018F000C00CB0395009100CB0365000C0006013300B9000601250020006B0038002E002300C0002E002B00AC002E006300E7002E001300C0002E001B00C0002E003300C6002E000B00AC002E003B00C0002E004B00C0002E005B00DE0040006B00380063001301380077009B004E000480000001000000121327860000000000009B02000002000000000000000000000001002B00000000000200000000000000000000000100A702000000000300020000000000003C4D6F64756C653E00636C6F75645365656465722E646C6C0053746F72656450726F63656475726573006D73636F726C69620053797374656D004F626A6563740053797374656D2E52756E74696D652E436F6D70696C65725365727669636573004973566F6C6174696C650073746F7070696E6700726571756573746564546872656164730072756E6E696E6754687265616473006E657874546872656164546F53746172740053797374656D2E436F6C6C656374696F6E732E47656E65726963004C69737460310053797374656D2E546872656164696E6700546872656164007468726561644C69737400737461727453656564696E670073746F7053656564696E67002E63746F72006E756D5468726561647300757365416666696E697479007969656C644D530053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500636C6F75645365656465720053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E5365727665720053716C50726F636564757265417474726962757465003C3E635F5F446973706C6179436C61737332003C737461727453656564696E673E625F5F3000496E7465726C6F636B656400496E6372656D656E7400426567696E546872656164416666696E697479004461746554696D65006765745F4E6F770044656372656D656E74006765745F4974656D00537461727400536C656570004D6F6E69746F7200456E74657200526561640045786368616E676500457869740054696D655370616E005375627472616374006765745F546F74616C4D696C6C697365636F6E647300456E64546872656164416666696E69747900546872656164537461727400416464002E6363746F7200436F6D70696C657247656E65726174656441747472696275746500000000000320000000000066FB65188E227D47AC7F6FD3B37E12CA0008B77A5C561934E08904061F090202060A070615120D011211060003010802080300000103200001042001010E0420010102042001010804010000000206020206080500010A100A040000114D0615120D0112110520011300080400010108040001011C0600020A100A0A0620011155114D0320000D11070708114D0A0815120D011211114D1155052002011C18052001011259052001011300100706081211081259120C15120D0112111301000E656E646C6573736C6F6F70636C72000005010000000017010012436F7079726967687420C2A920203230313200000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000DC2B00000000000000000000FE2B0000002000000000000000000000000000000000000000000000F02B00000000000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000000300000000000000000000000334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001002786121300000100278612133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00460020000010053007400720069006E006700460069006C00650049006E0066006F0000003C020000010030003000300030003000340062003000000048000F000100460069006C0065004400650073006300720069007000740069006F006E000000000065006E0064006C006500730073006C006F006F00700063006C0072000000000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003800380032002E00330034003300340033000000000040001000010049006E007400650072006E0061006C004E0061006D006500000063006C006F00750064005300650065006400650072002E0064006C006C0000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100320000004800100001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000063006C006F00750064005300650065006400650072002E0064006C006C00000040000F000100500072006F0064007500630074004E0061006D0065000000000065006E0064006C006500730073006C006F006F00700063006C0072000000000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003800380032002E00330034003300340033000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003800380032002E003300340033003400330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000103C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = UNSAFE
GO

CREATE PROCEDURE [dbo].[startSeeding]
( 
	--How many threads to create?
    @numThreads [sys].[int],
	--If 1, threads will use the threadaffinity API and will go preemptive
	--If 0, threads will be cooperatively scheduled
    @useAffinity [sys].[bit],
	--#ms to wait between explicit yields
	--0 == don't yield
    @yieldMS [sys].[int]
)
AS EXTERNAL NAME [cloudSeeder].[StoredProcedures].[startSeeding]
GO

--This proc stops all threads
CREATE PROCEDURE [dbo].[stopSeeding]
AS EXTERNAL NAME [cloudSeeder].[StoredProcedures].[stopSeeding]
GO

